<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>QR Code</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <button id="btn">Generate</button>
    <script>
      function generateQrCode() {
        QRCode.toDataURL('sample text', function (error, url) {
          if (error) {
            console.error(error);
            return;
          }

          const size = 256;
          const background = true;
          const shortName = 'P2';
          const name = 'test';

          const onImageDownload = () => {
            const canvas = document.getElementById('qr');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            img.onload = () => {
              canvas.width = size;
              canvas.height = size + (size / 16) * 1.5;
              if (background) {
                ctx.fillStyle = '#fff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
              }
              ctx.drawImage(img, size / 16, size / 16, size - size / 8, size - size / 8);
              ctx.fillStyle = '#000';
              ctx.fillStyle = '#000';
              ctx.font = `${(size / 16) * 1.5}px Arial`;
              ctx.textAlign = 'center';
              ctx.fillText(`Valeur: ${shortName}`, canvas.width / 2, size + (canvas.height - size) / 2);
              const pngFile = canvas.toDataURL('image/png');
              const downloadLink = document.createElement('a');
              downloadLink.download = `QRCode_${name}`;
              downloadLink.href = `${pngFile}`;
              downloadLink.click();
            };
            img.src = qrCodeDataURL;
          };
        });
      }

      var btn = document.getElementById('btn');
      btn.addEventListener('click', generateQrCode);
    </script>

    <div id="qrcode"></div>
    <script src="./dist/bundle.js"></script>
    <script type="text/javascript">
      BrowserQR.generate();
    </script>
  </body>
</html>
